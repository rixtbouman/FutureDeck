<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Futures Deck - Rate Scenarios</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --dark: #0d0d0d;
      --gold: #c9a227;
      --light: #f5f5f5;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Source Sans Pro', sans-serif;
      background: var(--dark);
      color: var(--light);
      min-height: 100vh;
    }

    header {
      text-align: center;
      padding: 40px 20px 20px;
      border-bottom: 1px solid rgba(201, 162, 39, 0.3);
    }

    header h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 36px;
      letter-spacing: 0.15em;
      color: var(--gold);
    }

    header p {
      color: rgba(255,255,255,0.6);
      margin-top: 8px;
    }

    nav {
      background: #1a1a1a;
      padding: 15px 20px;
      text-align: center;
    }

    nav a {
      color: rgba(255,255,255,0.7);
      text-decoration: none;
      margin: 0 15px;
      font-size: 14px;
      transition: color 0.2s;
    }

    nav a:hover { color: var(--gold); }

    main {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .scenario-container {
      background: #1a1a1a;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 30px;
    }

    .scenario-image {
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
    }

    .scenario-content {
      padding: 30px;
    }

    .scenario-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 28px;
      color: var(--gold);
      margin-bottom: 8px;
    }

    .scenario-subtitle {
      color: rgba(255,255,255,0.6);
      font-size: 14px;
      margin-bottom: 20px;
    }

    .scenario-text {
      color: rgba(255,255,255,0.85);
      line-height: 1.7;
      font-size: 15px;
    }

    .scenario-text p {
      margin-bottom: 15px;
    }

    .cards-used {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    .card-tag {
      background: rgba(201, 162, 39, 0.2);
      color: var(--gold);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .rating-panel {
      background: linear-gradient(135deg, #1a1a2e 0%, #0d0d15 100%);
      border-radius: 12px;
      padding: 30px;
      border: 1px solid rgba(201, 162, 39, 0.2);
    }

    .rating-panel h2 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 24px;
      color: var(--gold);
      margin-bottom: 25px;
      text-align: center;
    }

    .rating-group {
      margin-bottom: 25px;
    }

    .rating-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .rating-label span {
      font-weight: 600;
      color: rgba(255,255,255,0.9);
    }

    .rating-label small {
      color: rgba(255,255,255,0.5);
      font-size: 12px;
    }

    .rating-description {
      font-size: 13px;
      color: rgba(255,255,255,0.5);
      margin-bottom: 12px;
    }

    .rating-scale {
      display: flex;
      gap: 10px;
    }

    .rating-btn {
      flex: 1;
      padding: 12px 8px;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: rgba(255,255,255,0.6);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .rating-btn:hover {
      border-color: rgba(201, 162, 39, 0.5);
      color: rgba(255,255,255,0.9);
    }

    .rating-btn.selected {
      background: var(--gold);
      border-color: var(--gold);
      color: var(--dark);
      font-weight: 600;
    }

    .rating-btn small {
      display: block;
      font-size: 10px;
      margin-top: 4px;
      opacity: 0.7;
    }

    .notes-group {
      margin-bottom: 25px;
    }

    .notes-group label {
      display: block;
      font-weight: 600;
      color: rgba(255,255,255,0.9);
      margin-bottom: 10px;
    }

    .notes-group textarea {
      width: 100%;
      height: 100px;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 15px;
      color: var(--light);
      font-family: 'Source Sans Pro', sans-serif;
      font-size: 14px;
      resize: vertical;
    }

    .notes-group textarea:focus {
      outline: none;
      border-color: var(--gold);
    }

    .notes-group textarea::placeholder {
      color: rgba(255,255,255,0.3);
    }

    .button-row {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    .btn {
      flex: 1;
      padding: 15px 25px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--gold);
      color: var(--dark);
    }

    .btn-primary:hover {
      background: #d4b32a;
      transform: translateY(-2px);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: var(--light);
    }

    .btn-secondary:hover {
      background: rgba(255,255,255,0.2);
    }

    .progress-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 30px;
    }

    .progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      cursor: pointer;
      transition: all 0.2s;
    }

    .progress-dot.active {
      background: var(--gold);
      transform: scale(1.2);
    }

    .progress-dot.completed {
      background: rgba(201, 162, 39, 0.5);
    }

    .thank-you {
      text-align: center;
      padding: 60px 20px;
    }

    .thank-you h2 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 36px;
      color: var(--gold);
      margin-bottom: 15px;
    }

    .thank-you p {
      color: rgba(255,255,255,0.7);
      margin-bottom: 30px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 30px;
    }

    .stat-card {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }

    .stat-card .value {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 36px;
      color: var(--gold);
    }

    .stat-card .label {
      font-size: 12px;
      color: rgba(255,255,255,0.5);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    footer {
      text-align: center;
      padding: 30px;
      color: #666;
      font-size: 14px;
    }

    footer a { color: var(--gold); }

    @media (max-width: 600px) {
      .rating-scale {
        flex-wrap: wrap;
      }
      .rating-btn {
        flex: 0 0 calc(20% - 8px);
      }
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <header>
    <h1>RATE FUTURE SCENARIOS</h1>
    <p>Help us understand which futures resonate most</p>
  </header>

  <nav>
    <a href="index.html">About</a>
    <a href="play.html">Play</a>
    <a href="examples.html">Examples</a>
    <a href="rate.html" style="color: var(--gold);">Rate</a>
    <a href="print.html">Print</a>
  </nav>

  <main>
    <div class="progress-bar" id="progressBar"></div>

    <div id="scenarioView">
      <div class="scenario-container">
        <img class="scenario-image" id="scenarioImage" src="" alt="">
        <div class="scenario-content">
          <h2 class="scenario-title" id="scenarioTitle"></h2>
          <p class="scenario-subtitle" id="scenarioSubtitle"></p>
          <div class="scenario-text" id="scenarioText"></div>
          <div class="cards-used" id="cardsUsed"></div>
        </div>
      </div>

      <div class="rating-panel">
        <h2>Rate This Scenario</h2>

        <div class="rating-group">
          <div class="rating-label">
            <span>Plausibility</span>
            <small id="plausibilityValue">Not rated</small>
          </div>
          <p class="rating-description">How realistic is this scenario? Could it actually happen given current trends?</p>
          <div class="rating-scale" data-rating="plausibility">
            <button class="rating-btn" data-value="1">1<small>Fantasy</small></button>
            <button class="rating-btn" data-value="2">2<small>Unlikely</small></button>
            <button class="rating-btn" data-value="3">3<small>Possible</small></button>
            <button class="rating-btn" data-value="4">4<small>Probable</small></button>
            <button class="rating-btn" data-value="5">5<small>Inevitable</small></button>
          </div>
        </div>

        <div class="rating-group">
          <div class="rating-label">
            <span>Likelihood</span>
            <small id="likelihoodValue">Not rated</small>
          </div>
          <p class="rating-description">How likely is this specific scenario to occur in the stated timeframe?</p>
          <div class="rating-scale" data-rating="likelihood">
            <button class="rating-btn" data-value="1">1<small>0-5%</small></button>
            <button class="rating-btn" data-value="2">2<small>5-20%</small></button>
            <button class="rating-btn" data-value="3">3<small>20-50%</small></button>
            <button class="rating-btn" data-value="4">4<small>50-80%</small></button>
            <button class="rating-btn" data-value="5">5<small>80%+</small></button>
          </div>
        </div>

        <div class="rating-group">
          <div class="rating-label">
            <span>Utility</span>
            <small id="utilityValue">Not rated</small>
          </div>
          <p class="rating-description">How useful is this scenario for thinking about the future? How engaging to read?</p>
          <div class="rating-scale" data-rating="utility">
            <button class="rating-btn" data-value="1">1<small>Boring</small></button>
            <button class="rating-btn" data-value="2">2<small>Meh</small></button>
            <button class="rating-btn" data-value="3">3<small>Good</small></button>
            <button class="rating-btn" data-value="4">4<small>Great</small></button>
            <button class="rating-btn" data-value="5">5<small>Essential</small></button>
          </div>
        </div>

        <div class="notes-group">
          <label>Notes (Optional)</label>
          <textarea id="notesInput" placeholder="What did you like or dislike about this scenario? Any thoughts on how it could be improved?"></textarea>
        </div>

        <div class="button-row">
          <button class="btn btn-secondary" id="skipBtn">Skip</button>
          <button class="btn btn-primary" id="submitBtn" disabled>Submit & Next</button>
        </div>
      </div>
    </div>

    <div id="thankYouView" style="display: none;">
      <div class="thank-you">
        <h2>Thank You!</h2>
        <p>You've rated all available scenarios. Your feedback helps improve future visions.</p>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="value" id="totalRated">0</div>
            <div class="label">Scenarios Rated</div>
          </div>
          <div class="stat-card">
            <div class="value" id="avgPlausibility">-</div>
            <div class="label">Avg Plausibility</div>
          </div>
          <div class="stat-card">
            <div class="value" id="avgUtility">-</div>
            <div class="label">Avg Utility</div>
          </div>
        </div>

        <div class="button-row" style="justify-content: center; margin-top: 40px;">
          <button class="btn btn-primary" onclick="resetAndRestart()">Rate Again</button>
          <a href="examples.html" class="btn btn-secondary" style="text-decoration: none; text-align: center;">View All Scenarios</a>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>
      <a href="play.html">Create your own scenarios</a> with the Futures Deck.
    </p>
  </footer>

  <script>
    const SCENARIOS = [
      {
        id: 'quiet-redundancy',
        title: 'The Quiet Redundancy',
        subtitle: 'When AI handles everything, what remains for humans to do?',
        image: 'cards/scenario-01.png',
        cards: ['Autonomy', 'Collapse', 'City', 'AI', '5 Years'],
        text: `<p>It's 2029, and downtown Phoenix feels like a movie set between takes. The light rail still runs on schedule, but the cars are mostly empty. The coffee shops have perfected their automated systems—your cortado arrives via a small wheeled robot that thanks you by name—but the tables sit vacant.</p><p>The collapse wasn't dramatic. No riots, no breadlines. Just a slow evaporation of purpose. When the white-collar jobs went to AI—not just the data entry, but the analysis, the strategy, the creative work—people didn't starve. The UBI checks arrive like clockwork. But something else disappeared.</p>`
      },
      {
        id: 'comfort-mandate',
        title: 'The Comfort Mandate',
        subtitle: 'A disciplined society trades freedom for security at home',
        image: 'cards/scenario-02.png',
        cards: ['Security', 'Discipline', 'Home', 'Government Service', '2 Years'],
        text: `<p>After the third pandemic in five years, the Home Safety Bureau was inevitable. What started as voluntary wellness checks became mandatory "domestic compliance visits." The HSB agents are unfailingly polite—trained in de-escalation, armed only with tablets and air quality sensors. They're just here to help.</p><p>Your home must now meet federal Habitability Standards. Air filtration rated for viral particles. Food storage monitored for spoilage risk. Medication compliance verified through smart pill bottles that report to your health profile. It's all very reasonable. The data shows it saves lives.</p>`
      },
      {
        id: 'reef-resurrection',
        title: 'The Reef Resurrection',
        subtitle: 'A biotech breakthrough transforms ocean conservation',
        image: 'cards/scenario-03.png',
        cards: ['Stimulation', 'Transformation', 'Ocean', 'Biotech', 'Breakthrough', '10 Years'],
        text: `<p>They called it the Lazarus Coral—a synthetic organism that could survive in acidified, warming oceans while still providing habitat for marine life. When the team at the Okinawa Institute released their paper in 2028, marine biologists wept. Not from joy, but from the strangeness of hope after so many years of documenting death.</p><p>By 2035, the oceans are transforming into something unprecedented: not the ecosystems of the past, but something new. The Lazarus Coral comes in varieties now—some engineered for different depths, temperatures, chemical compositions.</p>`
      },
      {
        id: 'quantum-lottery',
        title: 'The Quantum Lottery',
        subtitle: 'When randomness becomes the last fair arbiter',
        image: 'cards/scenario-04.png',
        cards: ['Impact', 'Growth', 'Workplace', 'Quantum', 'Startup'],
        text: `<p>It started as a joke at a quantum computing startup in Austin. The founders, exhausted by the politics of promotion decisions, built a system that used quantum randomness to assign projects. True randomness—not algorithmic, not gameable, derived from the fundamental uncertainty of the universe itself.</p><p>The results were bizarre. A junior developer got assigned to lead the flagship product and, freed from imposter syndrome by the knowledge that no one had chosen him, delivered the best release in company history.</p>`
      },
      {
        id: 'precognition-clinic',
        title: 'The Precognition Clinic',
        subtitle: 'Quantum sensing detects disease years before symptoms appear',
        image: 'cards/scenario-05.png',
        cards: ['Security', 'Transformation', 'Hospital', 'Quantum', 'Device', '5 Years'],
        text: `<p>The breakthrough came from nanodiamond sensors—nitrogen-vacancy centers that could detect magnetic signatures of individual molecules. By 2030, the QuantumDx scanner could identify cancer cells seven years before they'd form a detectable tumor. Parkinson's, twelve years out. Alzheimer's markers, sometimes two decades before the first forgotten name.</p><p>The hospitals transformed. The old model—wait until symptoms, then treat—gave way to something stranger. Patients arrived healthy, felt healthy, looked healthy. They left with timelines.</p>`
      },
      {
        id: 'adopted-companion',
        title: 'The Adopted Companion',
        subtitle: 'When robots become family for the aging and alone',
        image: 'cards/scenario-06.png',
        cards: ['Relatedness', 'Transformation', 'Home', 'Robotics', "Gov't Service", '2 Years'],
        text: `<p>South Korea deployed the first wave in 2024—12,000 Hyodol companion robots distributed through welfare programs to seniors living alone. By 2027, the program had expanded across East Asia, Europe, and North America. The robots weren't sophisticated. They couldn't walk or clean or cook. They just... talked. Remembered. Asked about your day and actually listened to the answer.</p><p>The government called it "Companion Care." Critics called it "outsourcing filial piety to machines."</p>`
      },
      {
        id: 'great-unmasking',
        title: 'The Great Unmasking',
        subtitle: 'Q-Day arrives and the harvested past becomes readable',
        image: 'cards/scenario-07.png',
        cards: ['Autonomy', 'Collapse', 'City', 'Quantum', 'Setback', '10 Years'],
        text: `<p>They'd been warning about Q-Day for fifteen years. "Harvest now, decrypt later," the security researchers said. Nation-states and criminal organizations were vacuuming up encrypted traffic—storing petabytes of gibberish that would become readable once quantum computers matured. Most people shrugged. The future felt far away.</p><p>Then, in 2035, a research team in Shenzhen demonstrated Shor's algorithm on a 4,000-logical-qubit machine. RSA-2048 fell in six hours.</p>`
      },
      {
        id: 'last-portfolio',
        title: 'The Last Portfolio',
        subtitle: 'When AI masters creativity, what remains for the artist?',
        image: 'cards/scenario-08.png',
        cards: ['Competence', 'Transformation', 'Workplace', 'AI', 'Ritual', '5 Years'],
        text: `<p>The job postings stopped coming in 2027. Not all at once—first illustration, then graphic design, then copywriting. Computer graphic artists down 33% in a single year. Writers down 28%. Photographers holding on, barely, in niches where human presence still mattered.</p><p>The bifurcation was brutal. Creative directors—the ones who decided what to make—still had jobs. But the people who actually made things? They watched as companies discovered they could prompt their way to "good enough."</p>`
      },
      {
        id: 'quantum-divide',
        title: 'The Quantum Divide',
        subtitle: 'When only some can see the market\'s true patterns',
        image: 'cards/scenario-09.png',
        cards: ['Autonomy', 'Growth', 'Workplace', 'Quantum', 'Startup', 'Breakthrough'],
        text: `<p>HSBC announced it first: a 34% improvement in bond trading predictions using quantum-enhanced models. Then JPMorgan's $10 billion quantum initiative started showing returns. By 2029, the divide was undeniable. Firms with quantum access weren't just faster—they were operating in a different reality, seeing arbitrage opportunities invisible to classical systems.</p><p>The researchers called it "quantum advantage in trading"—game-theoretic models that exploited quantum entanglement to find higher-paying market equilibria.</p>`
      },
      {
        id: 'gifted-program',
        title: 'The Gifted Program',
        subtitle: 'When genetic enhancement creates a new kind of classroom divide',
        image: 'cards/scenario-10.png',
        cards: ['Competence', 'Discipline', 'School', 'Biotech', 'Startup', '10 Years'],
        text: `<p>The moratorium lasted eight years. Scientists had called for ten, but Singapore moved first, then Dubai. By 2035, germline editing for "cognitive optimization" was available to anyone who could reach the right clinic and pay the right price. The modifications were subtle—enhanced synaptic plasticity, optimized neurotransmitter regulation. Nothing superhuman. Just... better.</p><p>The first generation of enhanced children entered American schools in 2037. They weren't smarter in any obvious way—not at first. But they learned faster. Retained more. Focused longer.</p>`
      }
    ];

    let currentIndex = 0;
    let ratings = {};
    let completedIds = new Set();

    // Load saved progress
    function loadProgress() {
      const saved = localStorage.getItem('futuresDeckRatings');
      if (saved) {
        const data = JSON.parse(saved);
        ratings = data.ratings || {};
        completedIds = new Set(data.completedIds || []);
      }
    }

    // Save progress
    function saveProgress() {
      localStorage.setItem('futuresDeckRatings', JSON.stringify({
        ratings,
        completedIds: Array.from(completedIds)
      }));
    }

    // Find next unrated scenario
    function findNextUnrated() {
      for (let i = 0; i < SCENARIOS.length; i++) {
        if (!completedIds.has(SCENARIOS[i].id)) {
          return i;
        }
      }
      return -1; // All rated
    }

    // Render progress bar
    function renderProgressBar() {
      const bar = document.getElementById('progressBar');
      bar.innerHTML = SCENARIOS.map((s, i) => {
        let className = 'progress-dot';
        if (i === currentIndex) className += ' active';
        else if (completedIds.has(s.id)) className += ' completed';
        return `<div class="${className}" onclick="goToScenario(${i})"></div>`;
      }).join('');
    }

    // Render current scenario
    function renderScenario() {
      const scenario = SCENARIOS[currentIndex];

      document.getElementById('scenarioImage').src = scenario.image;
      document.getElementById('scenarioTitle').textContent = scenario.title;
      document.getElementById('scenarioSubtitle').textContent = scenario.subtitle;
      document.getElementById('scenarioText').innerHTML = scenario.text;
      document.getElementById('cardsUsed').innerHTML = scenario.cards
        .map(c => `<span class="card-tag">${c}</span>`).join('');

      // Reset ratings UI
      document.querySelectorAll('.rating-btn').forEach(btn => btn.classList.remove('selected'));
      document.getElementById('plausibilityValue').textContent = 'Not rated';
      document.getElementById('likelihoodValue').textContent = 'Not rated';
      document.getElementById('utilityValue').textContent = 'Not rated';
      document.getElementById('notesInput').value = '';
      document.getElementById('submitBtn').disabled = true;

      // Load existing rating if any
      if (ratings[scenario.id]) {
        const r = ratings[scenario.id];
        if (r.plausibility) selectRating('plausibility', r.plausibility);
        if (r.likelihood) selectRating('likelihood', r.likelihood);
        if (r.utility) selectRating('utility', r.utility);
        if (r.notes) document.getElementById('notesInput').value = r.notes;
      }

      renderProgressBar();
    }

    // Select a rating
    function selectRating(type, value) {
      const scale = document.querySelector(`.rating-scale[data-rating="${type}"]`);
      scale.querySelectorAll('.rating-btn').forEach(btn => {
        btn.classList.toggle('selected', btn.dataset.value == value);
      });

      const labels = {
        plausibility: ['Fantasy', 'Unlikely', 'Possible', 'Probable', 'Inevitable'],
        likelihood: ['0-5%', '5-20%', '20-50%', '50-80%', '80%+'],
        utility: ['Boring', 'Meh', 'Good', 'Great', 'Essential']
      };

      document.getElementById(`${type}Value`).textContent = `${value}/5 - ${labels[type][value-1]}`;
      checkSubmitEnabled();
    }

    // Check if submit should be enabled
    function checkSubmitEnabled() {
      const hasPlausibility = document.querySelector('.rating-scale[data-rating="plausibility"] .selected');
      const hasLikelihood = document.querySelector('.rating-scale[data-rating="likelihood"] .selected');
      const hasUtility = document.querySelector('.rating-scale[data-rating="utility"] .selected');
      document.getElementById('submitBtn').disabled = !(hasPlausibility && hasLikelihood && hasUtility);
    }

    // Submit rating
    function submitRating() {
      const scenario = SCENARIOS[currentIndex];

      ratings[scenario.id] = {
        plausibility: parseInt(document.querySelector('.rating-scale[data-rating="plausibility"] .selected')?.dataset.value),
        likelihood: parseInt(document.querySelector('.rating-scale[data-rating="likelihood"] .selected')?.dataset.value),
        utility: parseInt(document.querySelector('.rating-scale[data-rating="utility"] .selected')?.dataset.value),
        notes: document.getElementById('notesInput').value,
        timestamp: new Date().toISOString()
      };

      completedIds.add(scenario.id);
      saveProgress();

      goToNext();
    }

    // Go to next scenario
    function goToNext() {
      const nextIndex = findNextUnrated();
      if (nextIndex === -1) {
        showThankYou();
      } else {
        currentIndex = nextIndex;
        renderScenario();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    // Skip current scenario
    function skipScenario() {
      currentIndex = (currentIndex + 1) % SCENARIOS.length;
      if (completedIds.size === SCENARIOS.length) {
        showThankYou();
      } else {
        renderScenario();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    // Go to specific scenario
    function goToScenario(index) {
      currentIndex = index;
      renderScenario();
    }

    // Show thank you view
    function showThankYou() {
      document.getElementById('scenarioView').style.display = 'none';
      document.getElementById('thankYouView').style.display = 'block';

      // Calculate stats
      const ratingsList = Object.values(ratings);
      document.getElementById('totalRated').textContent = ratingsList.length;

      if (ratingsList.length > 0) {
        const avgP = (ratingsList.reduce((a, r) => a + r.plausibility, 0) / ratingsList.length).toFixed(1);
        const avgU = (ratingsList.reduce((a, r) => a + r.utility, 0) / ratingsList.length).toFixed(1);
        document.getElementById('avgPlausibility').textContent = avgP;
        document.getElementById('avgUtility').textContent = avgU;
      }
    }

    // Reset and restart
    function resetAndRestart() {
      completedIds.clear();
      saveProgress();
      currentIndex = 0;
      document.getElementById('scenarioView').style.display = 'block';
      document.getElementById('thankYouView').style.display = 'none';
      renderScenario();
    }

    // Event listeners
    document.querySelectorAll('.rating-scale').forEach(scale => {
      scale.addEventListener('click', (e) => {
        if (e.target.classList.contains('rating-btn')) {
          selectRating(scale.dataset.rating, e.target.dataset.value);
        }
      });
    });

    document.getElementById('submitBtn').addEventListener('click', submitRating);
    document.getElementById('skipBtn').addEventListener('click', skipScenario);

    // Initialize
    loadProgress();
    const startIndex = findNextUnrated();
    if (startIndex === -1) {
      showThankYou();
    } else {
      currentIndex = startIndex;
      renderScenario();
    }
  </script>

</body>
</html>
